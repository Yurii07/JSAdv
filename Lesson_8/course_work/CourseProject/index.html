<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Course work</title>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="./style.css">

</head>
<body>

<!-- <select id="countries"></select>
<select id="city"></select>
<div id="result"></div>

<div class="container" id="main">
    <h1>Weather Icons</h1>

    <div class="icon sunny" id="sunny">
        <div class="sun">
            <div class="rays"></div>
        </div>
    </div>

    <div class="icon rainy" id="rainy">
        <div class="cloud"></div>
        <div class="rain"></div>
    </div>

    <div class="icon cloudy" id="cloudy">
        <div class="cloud"></div>
        <div class="cloud"></div>
    </div>

    <div class="icon flurries" id="flurries">
        <div class="cloud"></div>
        <div class="snow">
            <div class="flake"></div>
            <div class="flake"></div>
        </div>
    </div>

    <div class="icon thunder-storm" id="thunder-storm">
        <div class="cloud"></div>
        <div class="lightning">
            <div class="bolt"></div>
            <div class="bolt"></div>
        </div>
    </div>

    <div class="icon sun-shower" id="sun-shower">
        <div class="cloud"></div>
        <div class="sun">
            <div class="rays"></div>
        </div>
        <div class="rain"></div>
    </div>
</div> -->


<div class="row">
    <h1>Get gurrent position</h1>
    <div class="col-sm-12">
        <form class="form-inline text-center first-child" onsubmit="FindCity();" role="form" id="searchform" action="#"
              method="get">
            <div class="form-group">
                <label class="sr-only" for="help-search">Search</label>

                <input class="form-control border-color col-sm-12" id="search_str" name="q" value="London, UK"
                       onfocus="this.value = (this.value=='London, UK')? '' : this.value;" placeholder="Search">

            </div>
            <button type="submit" class="btn btn-info" id="send"><i class="glyphicon glyphicon-search"></i> Search</button>

        </form>

    </div>
</div>

<div class="row" id='error'>
    <div class="col-sm-12">
        <div class="tab-pane active" id="forecast-list">
            <div id="forecast_list_ul">

                <table class="table" style="display: none">
                    <tbody>
                    <tr>
                        <td><img src="http://openweathermap.org/img/w/04d.png" id="weatherImg"></td>
                        <td><b><a href="/city/2643743" id="cityName"> London, GB</a></b>
                            <img src="http://openweathermap.org/images/flags/gb.png" id="flags"><b><i id="desc"> broken
                                clouds</i></b>
                            <p><span class="badge badge-info">20.6°С </span> temperature from 20 to 21 °С, wind 2.6 m/s.
                                clouds 56 %, 1021 hpa</p>
                            <p>Geo coords <a href="/weathermap?zoom=12&amp;lat=51.5085&amp;lon=-0.1258">[51.5085,
                                -0.1258]</a></p></td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<div class="div" id="response">

</div>


<!-- jQuery library -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

<script>


    var input = document.getElementById('search_str');
    console.log(input);

    document.addEventListener('DOMContentLoaded', function () {
    });


    function FindCity(name) {
        event.preventDefault();


        if (input.value != '') {

            var param = document.getElementById('search_str').value;
            const Http = new XMLHttpRequest();
            const url = 'http://api.openweathermap.org/data/2.5/weather?q=' + param + '&units=metric' + '&APPID=a701373c514912374872f7a940df00a7';

            Http.open("GET", url);
            Http.send();
            Http.onload = (e) =>{
                console.log(Http.responseText);

                var resp = document.getElementById('response');
                resp = Http.responseText;
                var respJSON = JSON.parse(resp);

                //выводим иконку погоды
                var icon = respJSON.weather[0].icon;
                // response.innerHTML = icon;
                // console.log(icon);
                resp = document.getElementById('weatherImg').setAttribute('src', "http://openweathermap.org/img/w/" + icon + ".png");
//название города
//             var cityName = respJSON.name;
//             // console.log(respJSON.name);
//             document.getElementById('cityName').innerHTML = cityName;
// response.innerHTML =  "<h2>Current weather for: "  + cityName + "<h2>";

//Выводим флаг стран
                var res = respJSON.sys.country.toLowerCase();
                var resFlags = document.getElementById('flags').setAttribute('src', "http://openweathermap.org/images/flags/" + res + ".png")

                // console.log(respJSON.sys.country)

                // var descr = respJSON.weather[0].description;
                // desc.innerHTML = descr;
                // console.log(desc);

                var cityName = respJSON.name;
                var countryn = respJSON.sys.country;
                var weatherMain = respJSON.weather[0].main;
                var description = respJSON.weather[0].description;
                var mainTemp = respJSON.main.temp;
                var pressure = respJSON.main.pressure;
                var humidity = respJSON.main.humidity;

                var tempMin = respJSON.main.temp_min;
                var tempMax = respJSON.main.temp_max;

                var windSpeed = respJSON.wind.speed;
                var windDeg = respJSON.wind.deg;

// function myFunc() {
// 	 return res.innerHTML = "<h2> Current Weather for " + cityName + ", " + countryn + "</h2> ";
// }
// myFunc();
                response.innerHTML = "<h2>Current Weather for " + cityName + " ," + countryn + "<h2>" +
                    "<h3>Weather: " + weatherMain + "<h3>" +
                    "<h3 stype='padding-left:10px'>Description: <img src='http://openweathermap.org/img/w/" + icon + ".png '> " + description + "<h3>" +
                    "<h3>Temperature: " + mainTemp + "&deg;C<h3>" +
                    "<h3>Pressure: " + pressure + " hPa<h3>" +
                    "<h3>Humidity: " + humidity + "%<h3>" +
                    "<h3>Min. Temperature: " + tempMin + "&deg;C<h3>" +
                    "<h3>Max. Temperature: " + tempMax + "&deg;C<h3>" +
                    "<h3>Wind Speed: " + windSpeed + "m/s<h3>" +
                    "<h3>Wind Direction: " + windDeg + "&deg;<h3>";

                console.log(weatherMain, description, mainTemp, pressure, humidity, tempMin, tempMax, windSpeed, windDeg, countryn, cityName)
            }
            ;

        } else {
            // alert ('Search can not be empty')

            document.getElementById('error').innerHTML = "<div class='alert alert-danger ' id='errorCity'><a href='#' class='close' data-dismiss='alert' aria-label='close'>&times;</a>Field can not be empty</div>"

        }

        return false;
    }


//
//    // GoogleMaps JavaScript API key

</script>


<!-- Latest compiled JavaScript -->
<!--<script src="dist/main.js"></script>-->
</body>
</html>

